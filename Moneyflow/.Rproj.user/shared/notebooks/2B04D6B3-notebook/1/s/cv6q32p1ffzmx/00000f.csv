"0","seller_industry_size <- invoices %>% "
"0","  group_by(seller_main_industry_code) %>% "
"0","  summarise(seller_ind_size = n()/nrow(invoices)) %>% "
"0","  select(seller_main_industry_code, seller_ind_size)"
"0",""
"0","seller_company_size <- invoices %>% "
"0","  group_by(seller_company_type) %>% "
"0","  summarise(seller_comp_size = n()/nrow(invoices)) %>% "
"0","  select(seller_company_type, seller_comp_size)"
"0",""
"0","payer_industry_size <- invoices %>% "
"0","  group_by(payer_main_industry_code) %>% "
"0","  summarise(payer_ind_size = n()/nrow(invoices)) %>% "
"0","  select(payer_main_industry_code, payer_ind_size)"
"0",""
"0","payer_company_size <- invoices %>% "
"0","  group_by(payer_company_type) %>% "
"0","  summarise(payer_comp_size = n()/nrow(invoices)) %>% "
"0","  select(payer_company_type, payer_comp_size)"
"0",""
"0","colnames(invoices)"
"1"," [1]"
"1"," ""invoice_id""                   "
"1"," ""invoice_amount""               "
"1"," ""seller_is_public""             "
"1"," ""seller_main_industry_code""    "
"1","
"
"1"," [5]"
"1"," ""seller_company_type""          "
"1"," ""seller_danish_pep""            "
"1"," ""seller_risika_score""          "
"1"," ""payer_is_public""              "
"1","
"
"1"," [9]"
"1"," ""payer_main_industry_code""     "
"1"," ""payer_company_type""           "
"1"," ""payer_danish_pep""             "
"1"," ""payer_eu_sanctions""           "
"1","
"
"1","[13]"
"1"," ""payer_risika_score""           "
"1"," ""offer_cost_percent""           "
"1"," ""offer_seller_is_first_invoice"""
"1"," ""inv_iss2due""                  "
"1","
"
"1","[17]"
"1"," ""inv_iss2purch""                "
"1"," ""inv_due2today""                "
"1"," ""seller_age""                   "
"1"," ""payerr_age""                   "
"1","
"
"1","[21]"
"1"," ""defaulted""                    "
"1","
"
"0","invoices_clean <- invoices %>% "
"0","  select(- invoice_id,"
"0","         - seller_is_public, #since there are only 12 observations which are all missing"
"0","         - payer_eu_sanctions) %>% "
"0","  mutate("
"0","    response = case_when(defaulted == 'y' ~ 1, T ~ 0),"
"0","    seller_danish_pep_num = as.numeric(seller_danish_pep),"
"0","    payer_is_public_num = case_when(payer_is_public == ""FALSE"" ~ 0,"
"0","                                    payer_is_public == ""TRUE"" ~ 1,"
"0","                                    T ~ NA_real_),"
"0","    payer_danish_pep_num = as.numeric(payer_danish_pep),"
"0","    "
"0","    payer_risika_score_num = suppressWarnings(as.numeric(payer_risika_score)),"
"0","    "
"0","    offer_seller_is_first_invoice_num = case_when(offer_seller_is_first_invoice == ""FALSE"" ~ 0,"
"0","                                    offer_seller_is_first_invoice == ""TRUE"" ~ 1,"
"0","                                    T ~ NA_real_),"
"0","    payer_age_num = suppressWarnings(case_when(as.numeric(payerr_age) == 2021 ~ 1,"
"0","                                               T ~ as.numeric(payerr_age))), # assuming 2021 is an error"
"0","    seller_age_num = as.numeric(seller_age),"
"0","    invoice_issue_date = today() - days(inv_due2today),"
"0","    invoice_issue_yearmonth = paste0(year(invoice_issue_date),"
"0","                                     case_when("
"0","                                       nchar(month(invoice_issue_date)) == 1 ~ paste0('0',month(invoice_issue_date)), "
"0","                                       T ~ as.character(month(invoice_issue_date)))),"
"0","    seller_payer_company_type_match = case_when(seller_company_type == payer_company_type ~ 1, T ~ 0),"
"0","    seller_payer_industry_type_match = case_when(seller_main_industry_code == payer_main_industry_code ~ 1, T ~ 0)) %>%"
"0","  "
"0","  left_join(seller_industry_size, by = 'seller_main_industry_code') %>% "
"0","  left_join(seller_company_size, by = 'seller_company_type') %>% "
"0","  left_join(payer_industry_size, by = 'payer_main_industry_code') %>% "
"0","  left_join(payer_company_size, by = 'payer_company_type') %>% "
"0","  "
"0","  mutate(payer_comp_type_f = case_when(payer_comp_size >0.50 ~'Large',"
"0","                                            payer_comp_size > 0.1 ~ 'Medium',"
"0","                                            T ~ 'Small'),"
"0","         seller_comp_type_f = case_when(seller_comp_size >0.50 ~'Large',"
"0","                                       seller_comp_size > 0.1 ~ 'Medium',"
"0","                                           T ~ 'Small'),"
"0","         payer_industry_size_f = case_when(payer_ind_size >0.1 ~'Large',"
"0","                                           payer_ind_size > 0.01 ~ 'Medium',"
"0","                                           T ~ 'Small'),"
"0","         seller_industry_size_f = case_when(seller_ind_size >0.07 ~'Large',"
"0","                                       seller_ind_size > 0.01 ~ 'Medium',"
"0","                                       T ~ 'Small'),"
"0","         ) %>% "
"0","filter(inv_due2today <= 360)"
"0",""
"0",""
